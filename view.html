<meta charset="utf-8">
<!DOCTYPE html>
<html>
<head>
	<title>view</title>
	<link rel="stylesheet" type="text/css" href="view.css">
	<script type="text/javascript" src='jquery.js'></script>
	<script type="text/javascript" src='view.js'></script>
</head>
<body>
	<header>
		<div id="logo">
			<img src="test.jpeg">
		</div>
		<div id='header_message'>
			欢迎，游客
		</div>
	</header>
	<section>
		<div id="teacher_info">
            <div id="info_pic">
                <img src="test.jpeg">
            </div>
            <div id="info_list">
                <ul>
                    <li id="info_list_name">
                        姓名：
                    </li>
                    <li id="info_list_id">
                        工号：
                    </li>
                    <li id="info_list_tel">
                        联系电话：
                    </li>
                </ul>
            </div>      
        </div>
        <div id='course_title'>
            以下为您创建的课程：
            <button id='new_course' onclick="jump_add_course()">new</button>
        </div>
        <div id='course_table'>
            <div id="table_top_guide" class="table_line">
                    <div id="table_guide_name" class="table_name">课程名</div>
                    <div id="table_guide_id" class="table_id">课程ID</div>
                    <div id="table_guide_user" class="table_user">创建用户</div>
                    <div id="table_guide_time" class="table_time">课程时间</div>
                    <div id='table_guide_status' class='table_status'>状态</div>
                    <div id="table_guide_button" class="table_button">操作</div>

                </div>
        </div>
	</section>
</body>
<style type="text/css">

#teacher_info{
    width:90%;
    margin-top: 30px;
}
#info_pic{
    width: 40%;
    float: left;
    margin-left: 5%;
    height: 200px;
    overflow: hidden;
}

#info_list{
    width: 30%;
    float: left;
    margin-left: 20%;
    height: 200px;
}

#info_list ul{
    list-style: none;
    margin-top: 50px;
}
#info_list li{
    margin-top: 30px;
}

#course_table{
    float: left;
    width: 90%;
    margin-left: 5%;
}
#course_title{
    background-color: rgba(240,242,243,0.8);
    box-shadow: 3px 3px 3px gray;
    margin-top: 30px;
    margin-left: 5%;
    width: 85%;
    float: left;
    padding: 15px 0 15px 5%;

}

#table_top_guide{
    margin-top: 30px;
}
#new_course{
    float: right;
    margin-right: 5%;

}
    body{
    margin:0;
    padding-left: 5%;
    padding-right: 5%;
    padding-top: 2%;
    background-color: rgba(240,242,243,0.8);
    font-family: 'open sans';
    color: gray;
}

header{
    height: 10%;
    position: absolute;
    top:2%;
    width: 90%;
    /*background-color: white;*/
}
#logo{
    position: relative;
    height: 100%;
    width: 30%;
    overflow: hidden;
    float: left;

}

#logo img{
    width: 100%;
}

#header_message{
    position: relative;
    float: right;
    top: 40%;
}


section{
    position:absolute;
    top: 15%;
    width: 90%;
    background-color: white;
}

.field_divide{
    height: 10%;
}

#manage{
    background-color: rgba(240,242,243,0.8);
    width: 90%;
    margin: 0;
    margin-left: 5%;
    height: 80%;
    padding: 0;
}

footer{
    position: absolute;
    bottom: 2%;
    text-align: center;
    width: 90%;
    color:#cccccc;
    font-weight: 200;
}
    .table_line{
        float: left;
        margin-left: 5%;
        width: 90%;
        text-align: center;
        background-color: transparent;
    }

    .table_name{
        padding-top: 5px;
        padding-bottom: 5px;
        position: relative;
        float: left;
        width: 15%;

        margin-top: 5px;
        margin-bottom: 5px;
    }

    .table_id{
        float: left;
        width: 15%;
        padding-top: 5px;
        padding-bottom: 5px;
        background-color: #999999;
        color: #dddddd;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    #table_guide_button{
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .table_user{
        float: left;
        width: 15%;
        padding-top: 5px;
        padding-bottom: 5px;

        margin-top: 5px;
        margin-bottom: 5px;
    }

    .table_time{
        float: left;
        width: 15%;
        padding-top: 5px;
        padding-bottom: 5px;
        background-color: #999999;
        color: #dddddd;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .table_status{
        float: left;
        width: 15%;
        padding-top: 5px;
        padding-bottom: 5px;
        background-color: #999999;
        color: #dddddd;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .table_button{
        float: left;
        width: 25%;
        padding-top: 5px;
        padding-bottom: 5px;

    }

    button{
        font-family: 'Open Sans', sans-serif;
        border: 2px solid #000;
        background: #fff;
        padding: 5px 12px;
        transition: color 300ms ease-in-out 0s,
                    background-color 300ms ease-in-out 0s, 
                    background-position 300ms ease-in-out 0s;
        text-transform: uppercase;
    }

    button:hover{
        background-color: #000;
        color: #fff;
        border: 2px solid #fff;
    }

</style>

<script type="text/javascript">
    var courseList=new Array();
    var idList=new Array();
    var userList=new Array();
    var timeList=new Array();
    var statusList=new Array();
    var login_id;
    var login_name;

$(document).ready(function(){
    var a=GetRequest();
    login_id=a.id;
    login_name=unescape(a.name);
    // $.ajax({
    //     url:'http://101.200.61.252:8080/user/login',       //undefined
    //     dataType:'json',
    //     cache:false,
    //     data:null,
    //     type:'POST',
    //     success:function(data){
    //         alert(data);
    //         login_id=data.identify;
    //         login_name=data.name;
    //     },
    //     error:function(){
    //         alert('123');
    //     }
    // });
    alert(login_id+login_name);
    initData();
    initPage();
});
    
function GetRequest() { 
    var url = location.search; //获取url中"?"符后的字串 
    var theRequest = new Object(); 
    if (url.indexOf("?") != -1) { 
        var str = url.substr(1); 
        strs = str.split("&"); 
        for(var i = 0; i < strs.length; i ++) { 
            theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]); 
        } 
    } 
    return theRequest; 
} 
//init data
function initData(){
    // for(var i=0;i<15;i++){
    //     courseList[i]=i;
    //     idList[i]=i*200;
    //     userList[i]=i+10083;
    //     timeList[i]=new Date();
    // }
    $.ajax({
        url:'http://101.200.61.252:8080/teacher/courselist',       //untested
        dataType:'json',
        cache:false,
        data:'identify='+login_id,
        type:'POST',
        success:function(data){
            for (var i = 0; i < data.length; i++) {
                courseList[i]=data[i].courseName;
                idList[i]=data[i].id;
                userList[i]=login_id;
                timeList[i]=data[i].time_list[0];
                statusList[i]=data[i].status;
            }
        }

    });
}


//end init

function initPage(){
    $("#header_message").html("欢迎，"+login_name);
    $("#info_list_name").html("姓名："+login_name);
    $("#info_list_id").html("工号："+login_id);

    for (var i = 0; i < courseList.length; i++) {
        $("#course_table").append(createDiv(courseList[i],idList[i],userList[i],timeList[i],statusList[i]));
    }
}



function createDiv(name,id,user,time,status){
    var temp=$("<div></div>");
    temp.attr("id",name+"_course");
    temp.attr("class",'table_line');

    var c_name=$("<div></div>");
    c_name.html(name);
    c_name.attr("class","table_name");

    var c_id=$("<div></div>");
    c_id.html(id);
    c_id.attr("class","table_id");

    var c_user=$("<div></div>");
    c_user.html(user);
    c_user.attr("class","table_user");

    var c_time=$("<div></div>");
    c_time.html(time.toLocaleTimeString());
    c_time.attr("class","table_time");

    var c_status=$("<div></div>");
    c_status.html(status);
    c_status.attr('class','table_status');


    var c_button=$("<div></div>");
    c_button.html("<button onclick='delCourse("+id+")'>delete</button> <button onclick='courseDetail("+id+"'>detail</button>");
    c_button.attr('class','table_button');


    $(temp).append(c_name);
    $(temp).append(c_id);
    $(temp).append(c_user);
    $(temp).append(c_time);
    $(temp).append(c_status);
    $(temp).append(c_button);

    return temp;
}
function jump_add_course(){
    window.location.assign("Add course.html?id="+login_id+'&name='+escape(login_name));
}
function delCourse(id){
    $.ajax({
        url:'http://101.200.61.252:8080/teacher/cancel',       //not tested
        dataType:'json',
        cache:false,
        data:'teacher_id='+login_id+'&course_id='+id,
        type:'POST',
        success:function(data){
            if(data.status==0)
                alert('success!');
            else
                alert('error!');
        }
    });

}
function courseDetail(id){
    
}
</script>
</html>